<!DOCTYPE html>
<html>
    <head>
        <link rel="stylesheet" href="taskdes.css">
        <title>TASK</title>
        
    </head>
    
    <body bgcolor="#000000">
        <audio id="btnclick">
            <!-- <source src="horse.ogg" type="audio/ogg"> -->
            <source src="btnclick.mp3" type="audio/mpeg">
            <!-- Your browser does not support the audio element. -->
        </audio>
        <!-- <br>
        <button class="b" onclick="javascript:stopc();">stop timer</button>
        <br> -->
        
        
            <div class="topheader"><div class="textcontent">40 SHADES OF GRAY</div></div>
            <p class="scores" id="score">SCORE CARD</p>
            
            <br>
            <input type="button" class="b" value="New user" onclick="javascript:getusername();"></input>
            <input type="button" value="New Game"class="b" onclick="javascript:cd();"></input>
            <input type="button" class="b" onclick="javascript:clearscores();" value="Clear Scores"id="clears"></input><br><br>
            <label for="difficulty">Level:</label>
            <select name="difficulty" class = "a"id="difficulty">
                <option value="Easy" class = "a">Easy</option>
                <option value="Normal" class = "a">Normal</option>
                <option value="Difficult" class = "a">Hard</option>
            </select>
            &NonBreakingSpace;
            <label for="grid">Grid:</label>
            <select name="grid" class = "a" id="grid">
                <option value="4*5">4 x 5</option>
                <option value="4*6">4 x 6</option>
            </select>
            <br><br>
            <div style="font-size: inherit;">
                <div class="stopclock" id="username">Username:</div>
                <div class="scores" id="tscore">Your score:</div>
                <div class="stopclock" id="sc">TIME:00:000s</div>
            </div>
            <div class="screenfull" style="display: none;" id="bgame">
                <div class="table">
                    <div class="button bt" id="btn1" onclick="javascript:oc('1');"></div>
                    <div class='button bt' id="btn2" onclick="javascript:oc('2');"></div>
                    <div class='button bt' id="btn3" onclick="javascript:oc('3');"></div>
                    <div class='button bt' id="btn4" onclick="javascript:oc('4');"></div>
                    <div class='button bt' id="btn5" onclick="javascript:oc('5');"></div>
                    <br>
                    <div class='button bt' id="btn6" onclick="javascript:oc('6');"></div>
                    <div class='button bt' id="btn7" onclick="javascript:oc('7');"></div>
                    <div class='button bt' id="btn8" onclick="javascript:oc('8');"></div>
                    <div class='button bt' id="btn9" onclick="javascript:oc('9');"></div>
                    <div class='button bt' id="btn10" onclick="javascript:oc('10');"></div>
                    <br>
                    <div class='button bt' id="btn11" onclick="javascript:oc('11');"></div>
                    <div class='button bt' id="btn12" onclick="javascript:oc('12');"></div>
                    <div class='button bt' id="btn13" onclick="javascript:oc('13');"></div>
                    <div class='button bt' id="btn14" onclick="javascript:oc('14');"></div>
                    <div class='button bt' id="btn15" onclick="javascript:oc('15');"></div>
                    <br>
                    <div class='button bt' id="btn16" onclick="javascript:oc('16');"></div>
                    <div class='button bt' id="btn17" onclick="javascript:oc('17');"></div>
                    <div class='button bt' id="btn18" onclick="javascript:oc('18');"></div>
                    <div class='button bt' id="btn19" onclick="javascript:oc('19');"></div>
                    <div class='button bt' id="btn20" onclick="javascript:oc('20');"></div>
                </div>
            </div>
            <div class="screenfull" style="display: none;" id="agame">
                <div class="table">
                    <div class="button bt" id="atn1" onclick="javascript:oc('1');"></div>
                    <div class='button bt' id="atn2" onclick="javascript:oc('2');"></div>
                    <div class='button bt' id="atn3" onclick="javascript:oc('3');"></div>
                    <div class='button bt' id="atn4" onclick="javascript:oc('4');"></div>
                    <div class='button bt' id="atn5" onclick="javascript:oc('5');"></div>
                    <div class='button bt' id="atn6" onclick="javascript:oc('6');"></div>
                    <br>
                    <div class="button bt" id="atn7" onclick="javascript:oc('7');"></div>
                    <div class='button bt' id="atn8" onclick="javascript:oc('8');"></div>
                    <div class='button bt' id="atn9" onclick="javascript:oc('9');"></div>
                    <div class='button bt' id="atn10" onclick="javascript:oc('10');"></div>
                    <div class='button bt' id="atn11" onclick="javascript:oc('11');"></div>
                    <div class='button bt' id="atn12" onclick="javascript:oc('12');"></div>
                    <br>
                    <div class="button bt" id="atn13" onclick="javascript:oc('13');"></div>
                    <div class='button bt' id="atn14" onclick="javascript:oc('14');"></div>
                    <div class='button bt' id="atn15" onclick="javascript:oc('15');"></div>
                    <div class='button bt' id="atn16" onclick="javascript:oc('16');"></div>
                    <div class='button bt' id="atn17" onclick="javascript:oc('17');"></div>
                    <div class='button bt' id="atn18" onclick="javascript:oc('18');"></div>
                    <br>
                    <div class="button bt" id="atn19" onclick="javascript:oc('19');"></div>
                    <div class='button bt' id="atn20" onclick="javascript:oc('20');"></div>
                    <div class='button bt' id="atn21" onclick="javascript:oc('21');"></div>
                    <div class='button bt' id="atn22" onclick="javascript:oc('22');"></div>
                    <div class='button bt' id="atn23" onclick="javascript:oc('23');"></div>
                    <div class='button bt' id="atn24" onclick="javascript:oc('24');"></div>
                </div>
            </div>
            <!-- <center> -->
            <div class="screenfull" onclick="javascript:cd();" style="display: inline-block; line-height: 12em;" id="start">
               
                <div class="tablescr" style="display: inline-block; text-align: center;">
                        <div style="font-size: 28px;color: black; text-align: center;"id="result">START</div>
                </div>
               
            </div>  
            <!-- </center> -->
            <div class="screenfull" style="display: none;" id="cdown">
                <div class="tablescr">
                    <div class = "countdown" id="ctext">3</div>
                </div>
            </div>   
            <p>
                Click the numbers as quickly as you can.
            </p>
        
        <script>
            var a2 = [];
            let r = 1;
            let starttime ,endtime;
            let sclock;
            let timerr = false;
            let y = document.getElementById("score");
            let x = document.getElementById("tscore");
            var btnclickS = document.getElementById("btnclick"); 
            let bname;
            var score;
            var user;
            let no;
            let boxes;
            let gameL;
            let gz;
            let difficultyl = document.getElementById("difficulty");
            let gridl = document.getElementById("grid");
            let startL = document.getElementById("start");
            let cdownl = document.getElementById("cdown");
            let resultl = document.getElementById("result");
            function getgrid(){
                let glevel = gridl.value;
                if(glevel == "4*5"){
                    gz = 20;
                    bname = 'b';
                    gameL = document.getElementById(`bgame`);
                }
                else{
                    gz = 24;
                    bname = 'a';
                    gameL = document.getElementById(`agame`);
                }
            }
            function difflevel(){
                let dlevel = difficultyl.value;
                let layers = 0;
                if(dlevel == "Easy"){
                    layers = 1;
                } 
                else if(dlevel == "Normal"){
                    layers = 2;
                }
                else{
                    layers = 3;
                }
                boxes = gz*layers;
            }
            function clearscores(){
                localStorage.clear();
                no = 0;
                updatehighscore();
            }
            // 
            no = Number(localStorage.getItem("no"));
            let userl=document.getElementById("username");
            updatehighscore();
            difflevel();
            // if(no == null){
            //     no = 0;
            //     y.innerHTML = no;
            // }
            // else{
            function updatehighscore(){  
                y.innerHTML = "SCORE CARD <br>" ; 
                if(no<=5){
                for(i=1;i<=no;i+=1){
                    let sp = localStorage.getItem(`score${i}`);
                    let np = localStorage.getItem(`name${i}`);
                    y.innerHTML = y.innerHTML + "<br>" +`${i} ${np} ${sp}s`;
                }
                }
                else{
                    for(i=1;i<=5;i+=1){
                    let sp = localStorage.getItem(`score${i}`);
                    let np = localStorage.getItem(`name${i}`);
                    y.innerHTML = y.innerHTML + "<br>" +`${i} ${np} ${sp}s`;
                }
                }
            }
            // // }
            // scores = localStorage.getItem('scores');
            // if(scores == null){
            //     y.innerHTML = "Scores not yet recorded";
            // }
            // else{
            //     y.innerHTML = scores;
                // let l = scores.length;
                // if(l <= 5){
                //     for(i = 0;i < scores.length();i+=1){
                //         y.innerHTML = y.innerHTML + `\n ${scores[i][0]}  ${scores[i][1]}`;
                //     }
                // }
                // else{
                //     for(i = 0;i < 5;i += 1){
                //         y.innerHTML = y.innerHTML + `\n ${scores[i][0]}  ${scores[i][1]}`;
                //     }
                // }
            // }
            // y.innerHTML = "Highest timing : " + scores[0];
            // let diff = localStorage.getItem("difference");
            // y.innerHTML = diff;
            
            // game.setAttribute("style","dislpay: none;");
            
            // game1.setAttribute("style","display: inline-block;");
            // function sg(){
            //     let gameL = document.getElementById("game");
            //     let cdownl = document.getElementById("cdown");
            //     let startL = document.getElementById("start");
            //     startL.setAttribute("style","display: none;");
            //     cdownl.setAttribute("style","display: block;");
            // }
            function getusername(){
                user = prompt("Enter User Name","");
                if(user == null || user == ""){
                    user = "Guest";
                }
                userl.innerHTML = "Username: " + user;                
            }
            function randomn(){
                r = 1;
                let a1=[];
                for(let i =0;i<gz;i++){
                    let temp = i+1;
                    a1[i] = temp;
                }
                let a3 = [];
                let n = gz;
                let n1 = 0;
                let e = 5;
                for(i = 0;i<gz;i++){
                    let m = n1 + Math.floor(Math.random() * n);
                    a2[i] = a1[m];
                    a3[i] = a1[m];
                    a1[m] = 0;
                    a1.sort();
                    n -= 1;
                    n1 += 1;
                }
                let k;
                for(i = 1;i <= gz;i += 1){
                    let x = document.getElementById(`${bname}tn${i}`);
                    x.innerHTML = a2[i-1];
                    k = 0.1 + a2[i-1] / (5 / 4 * boxes);
                    x.setAttribute("style",`background-color: rgb(0, 128, 0,${k});`);
                }
            }
            function refresh(){
                let k;
                for(i = 1;i <= gz;i += 1){
                    let x = document.getElementById(`${bname}tn${i}`);
                    x.innerHTML = a2[i-1];
                    k = 0.1 + a2[i-1] / (5 / 4 * boxes);
                    x.setAttribute("style",`background-color: rgb(0, 128, 0,${k});`);
                }
            }
            function oc(num){
                btnclickS.play();
                if(a2[num - 1] == r){
                    a2[num - 1] += gz;
                    if(a2[num - 1] > boxes){
                        a2[num - 1] = "";
                    }
                    if(r == boxes){
                        refresh();
                        stopc();
                    }
                    r += 1;
                    refresh();
                }
                // if(a2[num - 1] == boxes && r == boxes+1){
                //     if(a2[num - 1] <= (boxes - gz) && a2[num - 1] >= 1){
                //         a2[num - 1] += gz;
                //     }
                //     else
                //         a2[num - 1] = "";   
                //     refresh();
                //     stopc();
                // }
            }
            let a = 2;
            let t,ty;


            function cd(){
                if(timerr == true){
                    timerr = false;
                    clearInterval(sclock);
                }
                if(user == null){
                    user = prompt("Enter User Name","");
                    if(user == null || user == ""){
                        user = "Guest";
                    }
                    userl.innerHTML = "Username: " + user;  
                }
                if(gameL != null){
                gameL.setAttribute("style","display: none;");
                }
                getgrid();
                difflevel();
                a = 2;
                gameL.setAttribute("style","display: none;");
                startL.setAttribute("style","display: none;");
                cdownl.setAttribute("style","display: inline-block;");
                let ctextl = document.getElementById("ctext");
                ctextl.innerHTML = 3;
                ty = setInterval(set,1000);
                t = setTimeout(cancel,3000);
            }


            function set(){
                let ctextl = document.getElementById("ctext");
                ctextl.innerHTML = a;
                a -= 1 ;
            }
            function cancel(){
                clearInterval(ty);
                clearTimeout(t);
                cdownl.setAttribute("style","display: none;");
                gameL.setAttribute("style","display: inline-block;");
                randomn();
                startc();
            }
            function startc(){
                starttime = new Date().getTime();

                
                timerr = true;
                sclock = setInterval(update,1);
            }
            function update(){
                let updatetime = new Date().getTime();
                let difference = updatetime - starttime;
                let s = document.getElementById("sc");
                let seconds = Math.floor(difference / 1000);
                let milliseconds = difference % 1000;
                seconds = (seconds < 10) ? "0" + seconds : seconds;
                milliseconds = (milliseconds < 100) ? (milliseconds < 10) ? "00" + milliseconds : "0" + milliseconds : milliseconds;
                score = seconds + ":" + milliseconds;
                s.innerHTML = "TIME:"+ score + "s";
            }
            function stopc(){
                clearInterval(sclock);
                timerr = false;
                let s = document.getElementById("sc");
                updatescore(score);
                gameL.setAttribute("style","display: none;");
                startL.setAttribute("style","display: inline-block;");
                if(score != null){
                    resultl.innerHTML = "<br>"+`Your Score: ${score}s <br>` + "<br>START";
                }
                // sortandstore();
                checkandscore();
                updatehighscore();
            }
            function updatescore(timescorekk){
                x.innerHTML = "Your Score : " + timescorekk +"s";
            }
            function hello(){
                alert("hello");
            }
            function restart1(){
                gameL.setAttribute("style","display: none;");
                startL.setAttribute("style","display: inline-block;");
                startL.innerHTML = "RESTART"
                if(no<=5){
                for(i=1;i<=no;i+=1){
                    let sp = localStorage.getItem(`score${i}`);
                    let np = localStorage.getItem(`name${i}`);
                    startL.innerHTML = startL.innerHTML + "<br>" +`${i} ${np} ${sp}`;
                }
                }
                else{
                    for(i=1;i<=5;i+=1){
                    let sp = localStorage.getItem(`score${i}`);
                    let np = localStorage.getItem(`name${i}`);
                    startL.innerHTML = startL.innerHTML +"<br>" + `${i} ${np} ${sp}`;
                }
                } 
            }
            function sortandstore(){ 
                // sortByCol(scores,0);
                no += 1;
                if(no == 1){
                    localStorage.setItem(`score${no}`,score);
                    localStorage.setItem(`name${no}`,user);
                    localStorage.setItem("no",no);
                }
                else{
                    localStorage.setItem("no",no);
                    for(let i=1;i<no;i++)
                    {
                        if(score < localStorage.getItem(`score${i}`))
                        {
                            for(let j=no;j>i;j--)
                            {   let r= j-1;
                                let sp = localStorage.getItem(`score${r}`);
                                let np = localStorage.getItem(`name${r}`);
                                // console.log(np,'swapped with',sp);
                                localStorage.setItem(`score${j}`,sp);
                                localStorage.setItem(`name${j}`,np);
                            }
                            localStorage.setItem(`score${i}`,score);
                            localStorage.setItem(`name${i}`,user);
                            break;
                        }
                        else{
                            localStorage.setItem(`score${no}`,score);
                            localStorage.setItem(`name${no}`,user);
                        }
                    }
                }
            }
            function checkandscore(){
                if(no == 0){
                    no += 1;
                    localStorage.setItem(`score${no}`,score);
                    localStorage.setItem(`name${no}`,user);
                    localStorage.setItem("no",no);
                }
                else{
                    let i;
                    let k = 0;
                    for(let i=1;i<=no;i++){
                        if(user === localStorage.getItem(`name${i}`)){
                            k = 1;
                            if(score < localStorage.getItem(`score${i}`)){
                                localStorage.setItem(`score${i}`,score);
                            }
                            break;
                        }
                    }
                    if(k == 0){
                        // alert('hrll');
                        no += 1;
                        localStorage.setItem(`score${no}`,score);
                        localStorage.setItem(`name${no}`,user); 
                        localStorage.setItem("no",no);
                    }
                }
            }
            // function sortByCol(arr, colIndex){
            //     arr.sort(sortFunction)
            //     function sortFunction(a, b) {
            //         a1 = a[colIndex]
            //         b1 = b[colIndex]
            //         return (a1 === b1) ? 0 : (a1 < b1) ? -1 : 1
            //     }
            // }
        </script>
    </body>
</html>